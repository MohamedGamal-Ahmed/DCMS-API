<UserControl x:Class="DCMS.WPF.Views.AuditLogView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:converters="clr-namespace:DCMS.WPF.Converters"
             xmlns:components="clr-namespace:DCMS.WPF.Views.Components"
             Background="{DynamicResource MaterialDesignPaper}">
    
    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisConverter"/>
    </UserControl.Resources>
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Orientation="Horizontal">
            <TextBlock Text="Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª (Audit Log)" 
                       Style="{DynamicResource MaterialDesignHeadline4TextBlock}"
                       Margin="0,0,20,20"/>
            <Button Content="ðŸ”„ ØªØ­Ø¯ÙŠØ«" 
                    Style="{DynamicResource MaterialDesignRaisedButton}"
                    Command="{Binding RefreshCommand}"
                    Margin="5"/>
            
            <Button Content="ðŸ“¥ ØªØµØ¯ÙŠØ± Excel" 
                    Style="{DynamicResource MaterialDesignRaisedButton}"
                    Command="{Binding ExportCommand}"
                    Background="#27AE60"
                    Margin="5"/>
            
            <Button Content="ðŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†" 
                    Style="{DynamicResource MaterialDesignOutlinedButton}"
                    Command="{Binding ResetFiltersCommand}"
                    Margin="5"/>
        </StackPanel>

        <!-- Filters -->
        <materialDesign:Card Grid.Row="1" Padding="16" Margin="0,0,0,16">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Row 1: User, Action, Entity filters -->
                <ComboBox Grid.Column="0" 
                         materialDesign:HintAssist.Hint="Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"
                         Style="{DynamicResource MaterialDesignOutlinedComboBox}"
                         Margin="0,0,10,10"
                         ItemsSource="{Binding UserNames}"
                         SelectedItem="{Binding SelectedUserName, UpdateSourceTrigger=PropertyChanged}"/>

                <ComboBox Grid.Column="1" 
                         materialDesign:HintAssist.Hint="Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©"
                         Style="{DynamicResource MaterialDesignOutlinedComboBox}"
                         Margin="0,0,10,10"
                         ItemsSource="{Binding ActionTypes}"
                         SelectedItem="{Binding SelectedAction, UpdateSourceTrigger=PropertyChanged}"/>

                <ComboBox Grid.Column="2" 
                         materialDesign:HintAssist.Hint="Ù†ÙˆØ¹ Ø§Ù„ÙƒØ§Ø¦Ù†"
                         Style="{DynamicResource MaterialDesignOutlinedComboBox}"
                         Margin="0,0,10,10"
                         ItemsSource="{Binding EntityTypes}"
                         SelectedItem="{Binding SelectedEntityType, UpdateSourceTrigger=PropertyChanged}"/>

                <!-- Row 2: Date range -->
                <DatePicker Grid.Row="1" Grid.Column="0"
                           materialDesign:HintAssist.Hint="Ù…Ù† ØªØ§Ø±ÙŠØ®"
                           Style="{DynamicResource MaterialDesignOutlinedDatePicker}"
                           Margin="0,0,10,0"
                           SelectedDate="{Binding FromDate, UpdateSourceTrigger=PropertyChanged}"/>

                <DatePicker Grid.Row="1" Grid.Column="1"
                           materialDesign:HintAssist.Hint="Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®"
                           Style="{DynamicResource MaterialDesignOutlinedDatePicker}"
                           Margin="0,0,10,0"
                           SelectedDate="{Binding ToDate, UpdateSourceTrigger=PropertyChanged}"/>
            </Grid>
        </materialDesign:Card>

        <!-- DataGrid -->
        <DataGrid Grid.Row="2"
                 ItemsSource="{Binding Logs}"
                 AutoGenerateColumns="False"
                 IsReadOnly="True"
                 CanUserAddRows="False"
                 CanUserDeleteRows="False"
                 SelectionMode="Single"
                 SelectedItem="{Binding SelectedLog}"
                 materialDesign:DataGridAssist.CellPadding="8"
                 materialDesign:DataGridAssist.ColumnHeaderPadding="8">
            
            <DataGrid.Columns>
                <DataGridTextColumn Header="Ø§Ù„ÙˆÙ‚Øª" 
                                   Binding="{Binding Timestamp, StringFormat={}{0:yyyy-MM-dd HH:mm:ss}}" 
                                   Width="150"/>
                
                <DataGridTextColumn Header="Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" 
                                   Binding="{Binding UserName}" 
                                   Width="120"/>
                
                <DataGridTextColumn Header="Ø§Ù„Ø¹Ù…Ù„ÙŠØ©" 
                                   Binding="{Binding Action}" 
                                   Width="100"/>
                
                <DataGridTextColumn Header="Ù†ÙˆØ¹ Ø§Ù„ÙƒØ§Ø¦Ù†" 
                                   Binding="{Binding EntityType}" 
                                   Width="120"/>
                
                <DataGridTextColumn Header="Ù…Ø¹Ø±Ù Ø§Ù„ÙƒØ§Ø¦Ù†" 
                                   Binding="{Binding EntityId}" 
                                   Width="100"/>
                
                <DataGridTextColumn Header="Ø§Ù„ÙˆØµÙ" 
                                   Binding="{Binding Description}" 
                                   Width="*"/>
                
                <DataGridTemplateColumn Header="Ø§Ù„ØªÙØ§ØµÙŠÙ„" Width="100">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="Ø¹Ø±Ø¶" 
                                   Command="{Binding DataContext.ViewDetailsCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                   CommandParameter="{Binding}"
                                   Style="{DynamicResource MaterialDesignFlatButton}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Loading indicator -->
        <components:SkeletonLoaderView Grid.Row="2" 
                                       Background="White"
                                       RowCount="12"
                                       Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisConverter}}"
                                       HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>
    </Grid>
</UserControl>
