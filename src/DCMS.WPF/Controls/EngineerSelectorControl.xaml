<UserControl x:Class="DCMS.WPF.Controls.EngineerSelectorControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             FlowDirection="RightToLeft"
             d:DesignHeight="300" d:DesignWidth="400">
    
    <Border BorderBrush="#DDD" BorderThickness="1" CornerRadius="5" Background="White">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Search and Add Section -->
            <Grid Grid.Row="0" Margin="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Search Box -->
                <TextBox x:Name="SearchTextBox"
                         Grid.Column="0"
                         Height="35"
                         Padding="10,0"
                         FontSize="14"
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         BorderBrush="#CCC"
                         Margin="0,0,10,0"/>

                <!-- Add Button -->
                <Button Grid.Column="1"
                        Content="+ إضافة"
                        Command="{Binding AddEngineerCommand}"
                        Width="80"
                        Height="35"
                        Background="#4CAF50"
                        Foreground="White"
                        BorderThickness="0"
                        FontSize="14"
                        FontWeight="Bold"
                        Cursor="Hand"
                        IsEnabled="{Binding CanAddNewEngineer}">
                    <Button.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="5"/>
                        </Style>
                    </Button.Resources>
                </Button>
            </Grid>

            <!-- Selected Engineers (Chips) -->
            <ScrollViewer Grid.Row="1" 
                          MaxHeight="80" 
                          VerticalScrollBarVisibility="Auto"
                          Margin="10,0,10,10"
                          Visibility="{Binding HasSelectedEngineers, Converter={StaticResource BoolToVisConverter}}">
                <ItemsControl ItemsSource="{Binding SelectedEngineers}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="#E3F2FD"
                                    BorderBrush="#2196F3"
                                    BorderThickness="1"
                                    CornerRadius="15"
                                    Padding="10,5"
                                    Margin="0,0,5,5">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding FullName}" 
                                               FontSize="12"
                                               Foreground="#1976D2"
                                               VerticalAlignment="Center"/>
                                    <Button Content="✕"
                                            Command="{Binding DataContext.RemoveEngineerCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                            CommandParameter="{Binding}"
                                            Width="16"
                                            Height="16"
                                            Margin="8,0,0,0"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Foreground="#1976D2"
                                            FontSize="10"
                                            FontWeight="Bold"
                                            Cursor="Hand"
                                            Padding="0"/>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>

            <!-- Engineers List with Checkboxes -->
            <Border Grid.Row="2" 
                    BorderBrush="#EEE" 
                    BorderThickness="0,1,0,0"
                    Margin="10,0">
                <ListBox ItemsSource="{Binding FilteredEngineers}"
                         BorderThickness="0"
                         MaxHeight="200"
                         ScrollViewer.VerticalScrollBarVisibility="Auto">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="5"/>
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListBoxItem">
                                        <Border Background="{TemplateBinding Background}"
                                                BorderThickness="0"
                                                Padding="{TemplateBinding Padding}">
                                            <ContentPresenter/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#F5F5F5"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <CheckBox Content="{Binding Engineer.FullName}"
                                      IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                      FontSize="14"
                                      Foreground="#333"
                                      Padding="5,5"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Border>

            <!-- Status/Loading -->
            <TextBlock Grid.Row="3"
                       Text="{Binding StatusMessage}"
                       FontSize="12"
                       Foreground="#666"
                       Margin="10,5"
                       HorizontalAlignment="Center"
                       Visibility="{Binding HasStatusMessage, Converter={StaticResource BoolToVisConverter}}"/>
        </Grid>
    </Border>
</UserControl>
