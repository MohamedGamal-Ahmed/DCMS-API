@using System.Text.Json
@{
    Layout = null;
    var appData = ViewBag.AppData as string ?? "{}";
}

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>DCMS Hub - Mobile Viewer</title>
    <link rel="manifest" href="/manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.1/signalr.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        emerald: {
                            DEFAULT: '#008751',
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            600: '#008751',
                            700: '#006d41',
                            800: '#005734',
                            900: '#00472a',
                        }
                    },
                    fontFamily: {
                        sans: ['Tajawal', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Tajawal', sans-serif; -webkit-tap-highlight-color: transparent; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .tab-indicator { height: 4px; border-radius: 99px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .animate-fade-in { animation: fadeIn 0.4s ease-out; }
        @@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .calendar-dot { width: 4px; height: 4px; background-color: #008751; border-radius: 50%; margin-top: 2px; }
    </style>
</head>
<body class="bg-[#FDFDFE] text-gray-900 overflow-x-hidden pb-24">

    <!-- App Shell -->
    <div id="app" class="min-h-screen">
        
        <!-- Header -->
        <header class="px-6 py-4 flex items-center justify-between bg-white border-b border-gray-50 sticky top-0 z-50 shadow-sm">
            <div class="flex items-center gap-3">
                <button class="w-10 h-10 rounded-xl bg-gray-50 flex items-center justify-center text-gray-400 relative border border-gray-100 active:scale-95 transition-all">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v1m6 0H9" />
                    </svg>
                    <span class="absolute top-2.5 right-2.5 w-1.5 h-1.5 bg-red-500 rounded-full border border-white"></span>
                </button>
            </div>
            <div class="flex items-center gap-3">
                <div class="flex flex-col text-right">
                    <h1 class="text-[15px] font-black text-gray-900 leading-none tracking-tight">DCMS Hub</h1>
                    <span class="text-[9px] font-bold text-emerald uppercase tracking-widest mt-0.5">Mobile Viewer</span>
                </div>
                <div class="w-9 h-9 bg-emerald rounded-xl flex items-center justify-center text-white font-black text-lg shadow shadow-emerald/10">
                    D
                </div>
            </div>
        </header>

        <!-- Dynamic Content Area -->
        <main id="content" class="px-5 transition-all duration-300">
            <!-- Content will be injected by JavaScript -->
        </main>

        <!-- Bottom Navigation -->
        <nav class="fixed bottom-0 left-0 right-0 h-22 bg-white/95 backdrop-blur-md border-t border-gray-100 px-10 flex items-center justify-between z-50 shadow-[0_-5px_20px_rgba(0,0,0,0.03)] pb-4">
            <button onclick="switchTab('home')" id="tab-home" class="flex flex-col items-center gap-1.5 transition-all relative text-emerald">
                <div class="tab-indicator absolute -top-[16px] w-10 bg-emerald"></div>
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                <span class="text-[11px] font-black">الرئيسية</span>
            </button>
            <button onclick="switchTab('agenda')" id="tab-agenda" class="flex flex-col items-center gap-1.5 transition-all relative text-gray-300">
                <div class="tab-indicator absolute -top-[16px] w-10 bg-transparent"></div>
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                <span class="text-[11px] font-black">الأجندة</span>
            </button>
            <button onclick="switchTab('profile')" id="tab-profile" class="flex flex-col items-center gap-1.5 transition-all relative text-gray-300">
                <div class="tab-indicator absolute -top-[16px] w-10 bg-transparent"></div>
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                <span class="text-[11px] font-black">الملف</span>
            </button>
        </nav>
    </div>

    <script>
        // Data and State
        const AppData = @Html.Raw(appData);
        let activeTab = 'home';
        let searchQuery = '';
        let selectedDate = new Date();

        // SignalR Connection
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/chatHub")
            .withAutomaticReconnect()
            .build();

        connection.on("ReceiveMessage", () => {
             // In Viewer Mode, any hub message can trigger a background refresh
             fetchData();
        });

        async function fetchData() {
            try {
                const response = await fetch('/Mobile/GetData');
                const newData = await response.json();
                Object.assign(AppData, newData);
                render();
            } catch (err) { console.error("Refresh failed", err); }
        }

        // Tab Switching
        function switchTab(tab) {
            activeTab = tab;
            document.querySelectorAll('nav button').forEach(btn => {
                btn.classList.add('text-gray-300');
                btn.classList.remove('text-emerald');
                btn.querySelector('.tab-indicator').classList.replace('bg-emerald', 'bg-transparent');
            });
            const activeBtn = document.getElementById(`tab-${tab}`);
            activeBtn.classList.replace('text-gray-300', 'text-emerald');
            activeBtn.querySelector('.tab-indicator').classList.replace('bg-transparent', 'bg-emerald');
            render();
        }

        // Render Management
        function render() {
            const content = document.getElementById('content');
            content.innerHTML = '';
            
            if (activeTab === 'home') renderHome(content);
            else if (activeTab === 'agenda') renderAgenda(content);
            else if (activeTab === 'profile') renderProfile(content);
        }

        function renderHome(container) {
            const html = `
                <div class="animate-fade-in py-6 space-y-6">
                    <div>
                        <h2 class="text-xl font-black text-gray-900 leading-tight">أهلاً بك، ${AppData.user.name}</h2>
                        <div class="w-10 h-1.5 bg-emerald rounded-full mt-1.5 shadow-sm shadow-emerald/10"></div>
                    </div>

                    <!-- Meetings Section -->
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <h3 class="text-sm font-black text-gray-900 border-r-4 border-emerald pr-3">اجتماعات اليوم</h3>
                            <span class="text-[10px] font-bold bg-emerald/10 text-emerald px-2.5 py-1 rounded-full">${AppData.meetings.filter(m => isToday(m.date)).length} اجتماعات</span>
                        </div>
                        <div class="space-y-3">
                            ${AppData.meetings.filter(m => isToday(m.date)).map(m => `
                                <div class="bg-white p-5 rounded-[24px] border border-gray-100 shadow-sm flex items-center justify-between">
                                    <div class="flex flex-col gap-1">
                                        <span class="text-xs font-black text-emerald">${formatTime(m.date)}</span>
                                        <h4 class="text-sm font-black text-gray-900 leading-snug">${m.subject}</h4>
                                        <span class="text-[10px] font-bold text-gray-400">${m.fromOrTo}</span>
                                    </div>
                                    <button onclick="window.open('https://teams.microsoft.com', '_blank')" class="bg-emerald text-white px-5 py-2.5 rounded-xl font-black text-xs shadow-lg shadow-emerald/10 active:scale-95 transition-all flex items-center gap-2">
                                        انضمام
                                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="3" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="3" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                    </button>
                                </div>
                            `).join('') || '<p class="text-[10px] text-gray-400 text-center py-4">لا توجد اجتماعات اليوم</p>'}
                        </div>
                    </div>

                    <!-- Correspondence Section -->
                    <div class="space-y-4 pt-4">
                        <h3 class="text-sm font-black text-gray-900 border-r-4 border-emerald pr-3">المراسلات الأخيرة</h3>
                        <div class="relative">
                            <input type="text" oninput="handleSearch(this.value)" placeholder="البحث برقم المراسلة أو الموضوع..." class="w-full h-14 bg-white border border-gray-100 rounded-2xl px-12 text-sm focus:border-emerald outline-none shadow-sm transition-all" value="${searchQuery}">
                            <svg class="absolute right-4 top-4.5 w-5 h-5 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                        </div>
                        <div class="space-y-4 pt-2">
                            ${AppData.correspondences.filter(c => c.subject.includes(searchQuery) || c.subjectNumber.includes(searchQuery)).map(c => `
                                <div class="bg-white p-5 rounded-[32px] border border-gray-100 shadow-sm relative overflow-hidden group">
                                    <div class="flex items-center justify-between mb-4">
                                        <span class="text-[10px] font-black bg-emerald/5 text-emerald px-3 py-1.5 rounded-lg border border-emerald/10">${c.subjectNumber}</span>
                                        <span class="text-[10px] font-black bg-orange-50 text-orange-600 px-3 py-1.5 rounded-lg border border-orange-100">New</span>
                                    </div>
                                    <p class="text-sm font-black text-gray-900 leading-relaxed mb-6 line-clamp-2">${c.subject}</p>
                                    <div class="flex items-center justify-between border-t border-gray-50 pt-5">
                                        <div class="flex flex-col">
                                            <span class="text-[9px] font-black text-gray-300 uppercase leading-none">المهندس المسؤول</span>
                                            <span class="text-[11px] font-bold text-gray-600 mt-1">${c.responsibleEngineer || "غير معين"}</span>
                                            <span class="text-[9px] font-bold text-gray-300 mt-0.5">${c.date}</span>
                                        </div>
                                        <button onclick="viewPdf('${c.attachmentUrl}')" class="${c.attachmentUrl ? 'bg-emerald' : 'bg-gray-300 opacity-50 cursor-not-allowed'} text-white px-6 py-3 rounded-2xl font-black text-xs shadow-lg shadow-emerald/10 active:scale-95 transition-all flex items-center gap-2">
                                            عرض PDF
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            container.innerHTML = html;
        }

        function renderAgenda(container) {
            const daysInMonth = new Date(selectedDate.getFullYear(), selectedDate.getMonth() + 1, 0).getDate();
            const firstDay = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), 1).getDay();
            const monthName = selectedDate.toLocaleString('ar', { month: 'long', year: 'numeric' });
            
            const html = `
                <div class="animate-fade-in py-6 space-y-6">
                    <div class="flex items-center justify-between bg-white p-4 rounded-3xl shadow-sm border border-gray-50">
                        <button onclick="prevMonth()" class="w-10 h-10 bg-gray-50 rounded-xl flex items-center justify-center text-gray-400 active:scale-90 transition-all">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M9 5l7 7-7 7"/></svg>
                        </button>
                        <h2 class="text-base font-black text-gray-900">${monthName}</h2>
                        <button onclick="nextMonth()" class="w-10 h-10 bg-gray-50 rounded-xl flex items-center justify-center text-gray-400 active:scale-90 transition-all rotate-180">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M9 5l7 7-7 7"/></svg>
                        </button>
                    </div>

                    <div class="bg-white rounded-[32px] p-6 shadow-sm border border-gray-50">
                        <div class="grid grid-cols-7 gap-y-6 text-center text-[11px] font-black text-gray-300 uppercase mb-4">
                            <span>ج</span><span>ح</span><span>ن</span><span>ث</span><span>ر</span><span>خ</span><span>س</span>
                        </div>
                        <div class="grid grid-cols-7 gap-y-2">
                            ${Array(firstDay).fill('').map(() => '<span></span>').join('')}
                            ${Array(daysInMonth).fill(0).map((_, i) => {
                                const d = i+1;
                                const isSel = d === selectedDate.getDate();
                                const hasEv = AppData.meetings.some(m => new Date(m.date).getDate() === d && new Date(m.date).getMonth() === selectedDate.getMonth());
                                return `
                                    <button onclick="selectDay(${d})" class="flex flex-col items-center justify-center p-2 relative">
                                        <div class="w-10 h-10 flex items-center justify-center rounded-2xl text-xs font-black transition-all ${isSel ? 'bg-emerald text-white shadow-lg shadow-emerald/20' : 'text-gray-900 active:bg-gray-50'}">
                                            ${d}
                                        </div>
                                        ${hasEv && !isSel ? '<div class="calendar-dot"></div>' : ''}
                                    </button>
                                `;
                            }).join('')}
                        </div>
                    </div>

                    <div class="space-y-4">
                        <h3 class="text-[13px] font-black text-gray-300 pr-1">اليوم المختار</h3>
                        ${AppData.meetings.filter(m => new Date(m.date).getDate() === selectedDate.getDate() && new Date(m.date).getMonth() === selectedDate.getMonth()).map(m => `
                            <div class="bg-white p-6 rounded-[32px] border border-gray-50 shadow-sm space-y-5">
                                <div class="flex items-center justify-between">
                                    <div class="flex flex-col">
                                         <h4 class="text-base font-black text-gray-900">${m.subject}</h4>
                                         <span class="text-[11px] font-bold text-gray-400 mt-1">${m.fromOrTo}</span>
                                    </div>
                                    <div class="text-left">
                                         <span class="text-sm font-black text-emerald block">${formatTime(m.date)}</span>
                                         <span class="text-[9px] font-bold text-gray-300">Zoom • 12 مشارك</span>
                                    </div>
                                </div>
                                <button onclick="window.open('https://zoom.us', '_blank')" class="w-full h-14 bg-emerald text-white rounded-2xl font-black text-sm shadow-xl shadow-emerald/10 active:scale-[0.98] transition-all flex items-center justify-center gap-3">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                    انضم للاجتماع
                                </button>
                            </div>
                        `).join('') || '<p class="text-center py-10 bg-white rounded-[32px] text-[11px] font-bold text-gray-300">لا توجد اجتماعات في هذا اليوم</p>'}
                    </div>
                </div>
            `;
            container.innerHTML = html;
        }

        function renderProfile(container) {
            const html = `
                <div class="animate-fade-in py-8 space-y-8">
                    <div class="bg-white rounded-[40px] p-8 shadow-xl shadow-gray-100/50 border border-gray-50 text-center relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-emerald/5 rounded-full -mr-16 -mt-16"></div>
                        <div class="w-28 h-28 bg-emerald/10 rounded-full mx-auto mb-6 flex items-center justify-center border-4 border-white shadow-xl relative z-10">
                            <svg class="w-14 h-14 text-emerald" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.8" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                            <div class="absolute bottom-0 right-0 w-8 h-8 bg-white rounded-full border-2 border-emerald p-1.5 flex items-center justify-center shadow-lg">
                                <svg class="w-full h-full text-emerald" fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" /></svg>
                            </div>
                        </div>
                        <h2 class="text-2xl font-black text-gray-900">م/ ${AppData.user.name}</h2>
                        <p class="text-gray-400 font-bold text-[11px] mt-2 uppercase tracking-[2px]">مهندس أول - قطاع الطرق والكباري</p>
                    </div>

                    <div class="grid grid-cols-3 gap-4">
                        <div class="bg-white p-4 rounded-3xl border border-gray-50 shadow-sm text-center">
                            <span class="text-xl font-black text-emerald block">${AppData.stats.meetingsToday || 0}</span>
                            <span class="text-[8px] font-black text-gray-400 uppercase leading-tight mt-1 block">اجتماعاتي اليوم</span>
                        </div>
                        <div class="bg-white p-4 rounded-3xl border border-gray-50 shadow-sm text-center">
                            <span class="text-xl font-black text-blue-600 block">${AppData.stats.pendingIssues || 0}</span>
                            <span class="text-[8px] font-black text-gray-400 uppercase leading-tight mt-1 block">مواضيع معلقة</span>
                        </div>
                        <div class="bg-white p-4 rounded-3xl border border-gray-50 shadow-sm text-center">
                            <span class="text-xl font-black text-purple-600 block">${AppData.stats.completedReports || 0}</span>
                            <span class="text-[8px] font-black text-gray-400 uppercase leading-tight mt-1 block">تقارير منجزة</span>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <h3 class="text-xs font-black text-gray-400 uppercase tracking-widest px-1">أمان الحساب</h3>
                        <div class="bg-white rounded-3xl border border-gray-100 shadow-sm divide-y divide-gray-50 overflow-hidden">
                            <div class="p-6 flex items-center justify-between">
                                <div class="flex flex-col">
                                    <span class="text-[13px] font-bold text-gray-700">تنبيهات الدخول</span>
                                    <span class="text-[9px] text-gray-400 mt-0.5">إشعار عند كل دخول جديد للحساب</span>
                                </div>
                                <button class="w-12 h-7 bg-emerald rounded-full relative transition-all"><div class="w-5 h-5 bg-white rounded-full absolute top-1 right-1 shadow-sm"></div></button>
                            </div>
                            <div class="p-6 flex items-center justify-between">
                                <span class="text-[13px] font-bold text-gray-700">وضع توفير البيانات</span>
                                <button class="w-12 h-7 bg-gray-100 rounded-full relative transition-all"><div class="w-5 h-5 bg-white rounded-full absolute top-1 left-1 shadow-sm"></div></button>
                            </div>
                        </div>
                    </div>

                    <button onclick="handleLogout()" class="w-full py-6 bg-red-50 text-red-600 rounded-3xl text-sm font-black border border-red-100 shadow-sm active:scale-[0.98] transition-all flex items-center justify-center gap-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
                        تسجيل خروج آمن
                    </button>
                    
                    <div class="text-center pb-10 opacity-40">
                        <p class="text-[11px] font-black text-black">Developed By : Mohamed Gamal 2026</p>
                        <p class="text-[9px] font-black text-gray-400 mt-1 uppercase tracking-widest">DCMS VIEWER HUB V4.0.8</p>
                    </div>
                </div>
            `;
            container.innerHTML = html;
        }

        // Helpers
        function isToday(dateStr) {
            const d = new Date(dateStr);
            const now = new Date();
            return d.getDate() === now.getDate() && d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
        }

        function formatTime(dateStr) {
            return new Date(dateStr).toLocaleTimeString('ar', { hour: '2-digit', minute: '2-digit', hour12: true }).replace('AM', 'ص').replace('PM', 'م');
        }

        function handleSearch(val) {
            searchQuery = val;
            render();
        }

        function selectDay(d) {
            selectedDate = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), d);
            render();
        }

        function prevMonth() {
            selectedDate = new Date(selectedDate.getFullYear(), selectedDate.getMonth() - 1, 1);
            render();
        }

        function nextMonth() {
            selectedDate = new Date(selectedDate.getFullYear(), selectedDate.getMonth() + 1, 1);
            render();
        }

        function viewPdf(url) {
            if (!url || url === 'null' || url === 'undefined') return;
            const absoluteUrl = url.startsWith('http') ? url : `${window.location.origin}${url}`;
            window.open(absoluteUrl, '_blank', 'noopener,noreferrer');
        }
        function handleLogout() {
            // Placeholder for logout redirect
            window.location.href = '/Account/Logout'; // Adjust path
        }

        // Initialize PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js');
        }

        // Start App
        switchTab('home');
        connection.start().catch(err => console.error("SignalR connection error", err));

    </script>
</body>
</html>
